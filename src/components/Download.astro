---
import { Image } from 'astro:assets';
import { IconButton } from './IconButton.tsx';
import { IconDisplay } from './IconDisplay.tsx';
import FaultyTerminal from './FaultyTerminal.tsx';
import ReactLogo from '../images/React_dark.svg';
import EffectLogo from '../images/Effect TS_dark.svg';
---

<section class="py-20 px-4 bg-black">
  <div class="max-w-4xl mx-auto text-center">
    <h2 class="text-5xl sm:text-6xl md:text-7xl font-black mb-8">
      <span class="text-green-400">SAVE YOUR FUTURE SELF</span>
    </h2>

    <!-- Quick Start Section -->
    <div class="mb-12 p-8 bg-gradient-to-r from-electric-blue/10 via-purple-500/10 to-green-400/10 rounded-lg border border-gray-800">
      <h3 class="text-3xl font-bold text-white mb-6">Quick Start Guide</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <a href="https://react.dev/learn/you-might-not-need-an-effect" target="_blank" rel="noopener" class="group block p-4 bg-black/50 rounded-lg border border-gray-700 hover:border-warning-red/50 transition-all">
          <div class="flex items-center gap-3 mb-2">
            <IconDisplay icon="book" className="text-warning-red" size={24} client:visible />
            <p class="text-lg font-bold text-warning-red">Step 1: Unlearn</p>
          </div>
          <p class="text-sm text-gray-400 group-hover:text-gray-300">Read React's guide on avoiding useEffect</p>
        </a>
        <a href="https://effect.kitlangton.com/" target="_blank" rel="noopener" class="group block p-4 bg-black/50 rounded-lg border border-gray-700 hover:border-purple-400/50 transition-all">
          <div class="flex items-center gap-3 mb-2">
            <IconDisplay icon="zap" className="text-purple-400" size={24} client:visible />
            <p class="text-lg font-bold text-purple-400">Step 2: Explore</p>
          </div>
          <p class="text-sm text-gray-400 group-hover:text-gray-300">Play with Visual Effect playground</p>
        </a>
        <a href="https://effect.website" target="_blank" rel="noopener" class="group block p-4 bg-black/50 rounded-lg border border-gray-700 hover:border-green-400/50 transition-all">
          <div class="flex items-center gap-3 mb-2">
            <IconDisplay icon="check" className="text-green-400" size={24} client:visible />
            <p class="text-lg font-bold text-green-400">Step 3: Build</p>
          </div>
          <p class="text-sm text-gray-400 group-hover:text-gray-300">Start using Effect in your projects</p>
        </a>
      </div>
    </div>
    
    <div class="bg-gradient-to-br from-green-400/20 to-electric-blue/20 rounded-lg p-8 border border-green-400/30">
      <h3 class="text-3xl font-bold text-white mb-4">
        Download AGENTS.md
      </h3>
      <p class="text-xl text-gray-300 mb-6">
        Teach your AI to code better than a human<br/>
        <span class="text-sm text-gray-500">(Low bar, we know)</span>
      </p>
      
      <div id="download-btn">
        <IconButton 
          icon="download" 
          label="DOWNLOAD AGENTS.md" 
          variant="primary"
          client:load
        />
      </div>
      
      <div class="mt-6 space-y-2 text-sm text-gray-500">
        <div class="flex items-center justify-center gap-2">
          <IconDisplay icon="check" className="text-gray-500" size={16} client:visible />
          <span>Copy-paste into your project root</span>
        </div>
        <div class="flex items-center justify-center gap-2">
          <IconDisplay icon="zap" className="text-gray-500" size={16} client:visible />
          <span>Watch your AI write better code</span>
        </div>
        <div class="flex items-center justify-center gap-2">
          <IconDisplay icon="check" className="text-gray-500" size={16} client:visible />
          <span>Sleep peacefully at night</span>
        </div>
      </div>
    </div>

    <div class="mt-12 space-y-6">
      <div class="bg-gray-900/50 rounded-lg p-6 border border-gray-800">
        <h4 class="text-xl font-bold text-electric-blue mb-2">What's Inside?</h4>
        <ul class="text-left text-gray-300 space-y-2 max-w-2xl mx-auto">
          <li>✅ Clear instructions to NEVER use useEffect unless absolutely necessary</li>
          <li>✅ Introduction to Effect-TS with practical examples</li>
          <li>✅ Alternative patterns: useQuery, useSWR, and more</li>
          <li>✅ Decision tree for when useEffect is actually okay (spoiler: almost never)</li>
          <li>✅ Common pitfalls and how to avoid them</li>
        </ul>
      </div>

      <div class="text-center">
        <p class="text-2xl font-bold text-white mb-4">
          Join the Movement
        </p>
        <div class="flex justify-center gap-6">
          <IconButton 
            icon="twitter" 
            label="#DontUseEffect"
            href="https://twitter.com/intent/tweet?text=Don't%20useEffect,%20use%20Effect%20-%20One%20space.%20Infinite%20clarity.%20Zero%20outages.%20https://dontuseeffect.dev"
            variant="secondary"
            client:load
          />
          <IconButton 
            icon="github" 
            label="Star on GitHub"
            href="https://github.com/yourusername/use-effect"
            variant="secondary"
            client:load
          />
        </div>
      </div>
    </div>

    <!-- Final CTA -->
    <div class="mt-20 p-8 bg-gradient-to-r from-warning-red/10 via-purple-500/10 to-electric-blue/10 rounded-lg border border-gray-800">
      <div class="flex flex-col items-center space-y-4">
        <div class="flex items-center gap-4">
          <p class="text-4xl font-black text-white">Don't</p>
          <Image 
            src={ReactLogo} 
            alt="React" 
            width={45} 
            height={45}
            class="opacity-50"
          />
          <p class="text-4xl font-black text-warning-red line-through">useEffect</p>
        </div>
        <div class="flex items-center gap-4">
          <p class="text-4xl font-black text-white">use</p>
          <Image 
            src={EffectLogo} 
            alt="Effect-TS" 
            width={45} 
            height={45}
          />
          <p class="text-4xl font-black text-green-400">Effect</p>
        </div>
      </div>
      <p class="text-xl text-gray-400 mt-4">
        Your production environment will thank you.
      </p>
    </div>

    <!-- Footer -->
    <footer class="mt-20 pt-8 border-t border-gray-800">
      <p class="text-gray-500 text-sm">
        Made with <span class="text-green-400">love</span> and zero useEffects<br/>
        Inspired by the September 2025 incident that taught us all a lesson<br/>
        <a href="https://github.com/effect-ts/effect" class="text-electric-blue hover:underline">Effect-TS on GitHub →</a><br/>
        <a href="https://effect.website" class="text-electric-blue hover:underline">Official Documentation →</a><br/>
        <a href="https://blog.cloudflare.com/deep-dive-into-cloudflares-sept-12-dashboard-and-api-outage/" class="text-electric-blue hover:underline">Read the post-mortem →</a><br/>
        <a href="https://www.youtube.com/@effect-ts" class="text-electric-blue hover:underline">Effect YouTube Channel →</a>
      </p>
    </footer>

    <div class="relative mt-16 h-[560px] w-full overflow-hidden rounded-3xl border border-electric-blue/25 bg-black/60 backdrop-blur-xl shadow-[0_60px_140px_rgba(14,165,233,0.22)]">
      <FaultyTerminal
        client:visible
        scale={1.5}
        gridMul={[2, 1]}
        digitSize={1.2}
        timeScale={1}
        pause={false}
        scanlineIntensity={1}
        glitchAmount={1}
        flickerAmount={1}
        noiseAmp={1}
        chromaticAberration={0}
        dither={0}
        curvature={0}
        tint="#ffffff"
        mouseReact={true}
        mouseStrength={0.5}
        pageLoadAnimation={false}
        brightness={1}
      />
      <div class="pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-electric-blue/10 to-black opacity-70 mix-blend-screen"></div>
    </div>
  </div>
</section>

<script>
  document.getElementById('download-btn')?.addEventListener('click', async () => {
    try {
      // Fetch the AGENTS.md file from the public directory
      const response = await fetch('/AGENTS.md');
      const content = await response.text();
      
      // Create and trigger the download
      const blob = new Blob([content], { type: 'text/markdown' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'AGENTS.md';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      // Show success animation
      const btn = document.getElementById('download-btn');
      if (btn) {
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="relative z-10">✅ Downloaded!</span>';
        btn.classList.add('animate-pulse');
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.classList.remove('animate-pulse');
        }, 2000);
      }
    } catch (error) {
      console.error('Failed to download AGENTS.md:', error);
      alert('Failed to download AGENTS.md. Please try again.');
    }
  });
</script>
